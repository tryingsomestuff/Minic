<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage - Source/cli.cpp</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="title">LCOV - code coverage report</td></tr>
            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

            <tr>
              <td width="100%">
                <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="10%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">Source</a> - cli.cpp<span style="font-size: 80%;"> (source / <a href="cli.cpp.func-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="5%"></td>
            <td width="5%" class="headerCovTableHead">Coverage</td>
            <td width="5%" class="headerCovTableHead" title="Covered + Uncovered code">Total</td>
            <td width="5%" class="headerCovTableHead" title="Exercised code only">Hit</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntryLo">46.5&nbsp;%</td>
            <td class="headerCovTableEntry">288</td>
            <td class="headerCovTableEntry">134</td>
          </tr>
          <tr>
            <td class="headerItem">Test Date:</td>
            <td class="headerValue">2025-12-15 11:28:56</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntryLo">66.7&nbsp;%</td>
            <td class="headerCovTableEntry">6</td>
            <td class="headerCovTableEntry">4</td>
          </tr>
                  <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
                </table>
              </td>
            </tr>

            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
          </table>

          <table cellpadding=0 cellspacing=0 border=0>
            <tr>
              <td><br></td>
            </tr>
            <tr>
              <td>
<pre class="sourceHeading">            Line data    Source code</pre>
<pre class="source">
<span id="L1"><span class="lineNum">       1</span>              : #include &quot;cli.hpp&quot;</span>
<span id="L2"><span class="lineNum">       2</span>              : </span>
<span id="L3"><span class="lineNum">       3</span>              : #include &quot;com.hpp&quot;</span>
<span id="L4"><span class="lineNum">       4</span>              : #include &quot;dynamicConfig.hpp&quot;</span>
<span id="L5"><span class="lineNum">       5</span>              : #include &quot;evalDef.hpp&quot;</span>
<span id="L6"><span class="lineNum">       6</span>              : #include &quot;logging.hpp&quot;</span>
<span id="L7"><span class="lineNum">       7</span>              : #include &quot;material.hpp&quot;</span>
<span id="L8"><span class="lineNum">       8</span>              : #include &quot;moveApply.hpp&quot;</span>
<span id="L9"><span class="lineNum">       9</span>              : #include &quot;moveGen.hpp&quot;</span>
<span id="L10"><span class="lineNum">      10</span>              : #include &quot;option.hpp&quot;</span>
<span id="L11"><span class="lineNum">      11</span>              : #include &quot;position.hpp&quot;</span>
<span id="L12"><span class="lineNum">      12</span>              : #include &quot;searcher.hpp&quot;</span>
<span id="L13"><span class="lineNum">      13</span>              : #include &quot;tables.hpp&quot;</span>
<span id="L14"><span class="lineNum">      14</span>              : #include &quot;timeMan.hpp&quot;</span>
<span id="L15"><span class="lineNum">      15</span>              : #include &quot;tools.hpp&quot;</span>
<span id="L16"><span class="lineNum">      16</span>              : #include &quot;transposition.hpp&quot;</span>
<span id="L17"><span class="lineNum">      17</span>              : #include &quot;uci.hpp&quot;</span>
<span id="L18"><span class="lineNum">      18</span>              : #include &quot;xboard.hpp&quot;</span>
<span id="L19"><span class="lineNum">      19</span>              : </span>
<span id="L20"><span class="lineNum">      20</span>              : // see cli_perft.cpp</span>
<span id="L21"><span class="lineNum">      21</span>              : [[nodiscard]] bool perft_test(const std::string&amp; fen, DepthType d, uint64_t expected);</span>
<span id="L22"><span class="lineNum">      22</span>              : Counter perft(const Position&amp; p, DepthType depth, PerftAccumulator&amp; acc);</span>
<span id="L23"><span class="lineNum">      23</span>              : </span>
<span id="L24"><span class="lineNum">      24</span>              : // see cli_selfplay.cpp</span>
<span id="L25"><span class="lineNum">      25</span>              : void selfPlay(DepthType depth, uint64_t &amp; nbPos);</span>
<span id="L26"><span class="lineNum">      26</span>              : </span>
<span id="L27"><span class="lineNum">      27</span>              : // see cli_SEETest.cpp</span>
<span id="L28"><span class="lineNum">      28</span>              : bool TestSEE();</span>
<span id="L29"><span class="lineNum">      29</span>              : </span>
<span id="L30"><span class="lineNum">      30</span> <span class="tlaGNC tlaBgGNC">         174 : void analyze(const Position&amp; p, DepthType depth, bool openBenchOutput = false) {</span></span>
<span id="L31"><span class="lineNum">      31</span>              :    static double  benchms    = 0;</span>
<span id="L32"><span class="lineNum">      32</span>              :    static Counter benchNodes = 0;</span>
<span id="L33"><span class="lineNum">      33</span>              : </span>
<span id="L34"><span class="lineNum">      34</span> <span class="tlaGNC">         174 :    const int oldOutLvl = DynamicConfig::minOutputLevel;</span></span>
<span id="L35"><span class="lineNum">      35</span> <span class="tlaGNC">         174 :    if (openBenchOutput) { DynamicConfig::minOutputLevel = Logging::logOff; }</span></span>
<span id="L36"><span class="lineNum">      36</span>              : </span>
<span id="L37"><span class="lineNum">      37</span> <span class="tlaGNC">         174 :    TimeMan::isDynamic                   = false;</span></span>
<span id="L38"><span class="lineNum">      38</span> <span class="tlaGNC">         174 :    TimeMan::nbMoveInTC                  = -1;</span></span>
<span id="L39"><span class="lineNum">      39</span> <span class="tlaGNC">         174 :    TimeMan::msecPerMove                 = INFINITETIME;</span></span>
<span id="L40"><span class="lineNum">      40</span> <span class="tlaGNC">         174 :    TimeMan::msecInTC                    = -1;</span></span>
<span id="L41"><span class="lineNum">      41</span> <span class="tlaGNC">         174 :    TimeMan::msecInc                     = -1;</span></span>
<span id="L42"><span class="lineNum">      42</span> <span class="tlaGNC">         174 :    TimeMan::msecUntilNextTC             = -1;</span></span>
<span id="L43"><span class="lineNum">      43</span> <span class="tlaGNC">         174 :    ThreadPool::instance().currentMoveMs = TimeMan::getNextMSecPerMove(p);</span></span>
<span id="L44"><span class="lineNum">      44</span>              : </span>
<span id="L45"><span class="lineNum">      45</span> <span class="tlaGNC">         174 :    ThreadData d;</span></span>
<span id="L46"><span class="lineNum">      46</span>              : #ifdef WITH_ASYNC_ANALYZE</span>
<span id="L47"><span class="lineNum">      47</span> <span class="tlaGNC">         174 :    COM::depth = depth;</span></span>
<span id="L48"><span class="lineNum">      48</span> <span class="tlaGNC">         174 :    const std::string fen = GetFEN(p);</span></span>
<span id="L49"><span class="lineNum">      49</span> <span class="tlaGNC">         174 :    const bool b = readFEN(fen, COM::position, true, true);</span></span>
<span id="L50"><span class="lineNum">      50</span> <span class="tlaGNC">         174 :    if (!b) Logging::LogIt(Logging::logFatal) &lt;&lt; &quot;Illegal FEN &quot; &lt;&lt; fen;</span></span>
<span id="L51"><span class="lineNum">      51</span> <span class="tlaGNC">         174 :    COM::thinkAsync(COM::st_searching);</span></span>
<span id="L52"><span class="lineNum">      52</span> <span class="tlaGNC">        7487 :    while(ThreadPool::instance().main().searching()){</span></span>
<span id="L53"><span class="lineNum">      53</span>              :       using namespace std::chrono_literals;</span>
<span id="L54"><span class="lineNum">      54</span> <span class="tlaGNC">        7313 :       std::this_thread::sleep_for(10ms);</span></span>
<span id="L55"><span class="lineNum">      55</span>              :    }</span>
<span id="L56"><span class="lineNum">      56</span>              : #else</span>
<span id="L57"><span class="lineNum">      57</span>              :    d.p     = p;</span>
<span id="L58"><span class="lineNum">      58</span>              :    d.depth = depth;</span>
<span id="L59"><span class="lineNum">      59</span>              :    ThreadPool::instance().distributeData(d);</span>
<span id="L60"><span class="lineNum">      60</span>              :    ThreadPool::instance().main().stopFlag = false;</span>
<span id="L61"><span class="lineNum">      61</span>              :    ThreadPool::instance().main().searchDriver(false);</span>
<span id="L62"><span class="lineNum">      62</span>              : #endif</span>
<span id="L63"><span class="lineNum">      63</span> <span class="tlaGNC">         174 :    d = ThreadPool::instance().main().getData();</span></span>
<span id="L64"><span class="lineNum">      64</span> <span class="tlaGNC">         696 :    Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Best move is &quot; &lt;&lt; ToString(d.best) &lt;&lt; &quot; &quot; &lt;&lt; static_cast&lt;int&gt;(d.depth) &lt;&lt; &quot; &quot; &lt;&lt; d.score &lt;&lt; &quot; pv : &quot; &lt;&lt; ToString(d.pv);</span></span>
<span id="L65"><span class="lineNum">      65</span>              : </span>
<span id="L66"><span class="lineNum">      66</span> <span class="tlaGNC">         174 :    if (openBenchOutput) {</span></span>
<span id="L67"><span class="lineNum">      67</span> <span class="tlaGNC">           5 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Next two lines are for OpenBench&quot;;</span></span>
<span id="L68"><span class="lineNum">      68</span> <span class="tlaGNC">           5 :       const TimeType ms = getTimeDiff(ThreadPool::instance().main().startTime);</span></span>
<span id="L69"><span class="lineNum">      69</span>              :       const Counter nodeCount =</span>
<span id="L70"><span class="lineNum">      70</span> <span class="tlaGNC">           5 :           ThreadPool::instance().main().stats.counters[Stats::sid_nodes] + ThreadPool::instance().main().stats.counters[Stats::sid_qnodes];</span></span>
<span id="L71"><span class="lineNum">      71</span> <span class="tlaGNC">           5 :       benchNodes += nodeCount;</span></span>
<span id="L72"><span class="lineNum">      72</span> <span class="tlaGNC">           5 :       benchms += static_cast&lt;decltype(benchms)&gt;(ms) / 1000.;</span></span>
<span id="L73"><span class="lineNum">      73</span> <span class="tlaGNC">           5 :       DynamicConfig::minOutputLevel = oldOutLvl;</span></span>
<span id="L74"><span class="lineNum">      74</span> <span class="tlaGNC">           5 :       std::cerr &lt;&lt; &quot;NODES &quot; &lt;&lt; benchNodes &lt;&lt; std::endl;</span></span>
<span id="L75"><span class="lineNum">      75</span> <span class="tlaGNC">           5 :       std::cerr &lt;&lt; &quot;NPS &quot; &lt;&lt; static_cast&lt;int&gt;(static_cast&lt;decltype(benchms)&gt;(benchNodes) / benchms) &lt;&lt; std::endl;</span></span>
<span id="L76"><span class="lineNum">      76</span>              :    }</span>
<span id="L77"><span class="lineNum">      77</span> <span class="tlaGNC">         174 : }</span></span>
<span id="L78"><span class="lineNum">      78</span>              : </span>
<span id="L79"><span class="lineNum">      79</span>              : // This struct is dedicated to display beta cut statistics in benchmark</span>
<span id="L80"><span class="lineNum">      80</span>              : struct BetaCutStat{</span>
<span id="L81"><span class="lineNum">      81</span>              :    Counter betaCuts   = 0ull;</span>
<span id="L82"><span class="lineNum">      82</span>              :    Counter betaCutsTT = 0ull;</span>
<span id="L83"><span class="lineNum">      83</span>              :    Counter betaCutsGC = 0ull;</span>
<span id="L84"><span class="lineNum">      84</span>              :    Counter betaCutsP  = 0ull;</span>
<span id="L85"><span class="lineNum">      85</span>              :    Counter betaCutsK1 = 0ull;</span>
<span id="L86"><span class="lineNum">      86</span>              :    Counter betaCutsK2 = 0ull;</span>
<span id="L87"><span class="lineNum">      87</span>              :    Counter betaCutsK3 = 0ull;</span>
<span id="L88"><span class="lineNum">      88</span>              :    Counter betaCutsK4 = 0ull;</span>
<span id="L89"><span class="lineNum">      89</span>              :    Counter betaCutsC  = 0ull;</span>
<span id="L90"><span class="lineNum">      90</span>              :    Counter betaCutsQ  = 0ull;</span>
<span id="L91"><span class="lineNum">      91</span>              :    Counter betaCutsBC = 0ull;</span>
<span id="L92"><span class="lineNum">      92</span>              : </span>
<span id="L93"><span class="lineNum">      93</span> <span class="tlaGNC">           5 :    void update(const Stats&amp; stats){</span></span>
<span id="L94"><span class="lineNum">      94</span> <span class="tlaGNC">           5 :       betaCuts   += stats.counters[Stats::sid_beta] + stats.counters[Stats::sid_ttbeta];</span></span>
<span id="L95"><span class="lineNum">      95</span> <span class="tlaGNC">           5 :       betaCutsTT += stats.counters[Stats::sid_ttbeta];</span></span>
<span id="L96"><span class="lineNum">      96</span> <span class="tlaGNC">           5 :       betaCutsGC += stats.counters[Stats::sid_beta_gc];</span></span>
<span id="L97"><span class="lineNum">      97</span> <span class="tlaGNC">           5 :       betaCutsP  += stats.counters[Stats::sid_beta_p];</span></span>
<span id="L98"><span class="lineNum">      98</span> <span class="tlaGNC">           5 :       betaCutsK1 += stats.counters[Stats::sid_beta_k1];</span></span>
<span id="L99"><span class="lineNum">      99</span> <span class="tlaGNC">           5 :       betaCutsK2 += stats.counters[Stats::sid_beta_k2];</span></span>
<span id="L100"><span class="lineNum">     100</span> <span class="tlaGNC">           5 :       betaCutsK3 += stats.counters[Stats::sid_beta_k3];</span></span>
<span id="L101"><span class="lineNum">     101</span> <span class="tlaGNC">           5 :       betaCutsK4 += stats.counters[Stats::sid_beta_k4];</span></span>
<span id="L102"><span class="lineNum">     102</span> <span class="tlaGNC">           5 :       betaCutsC  += stats.counters[Stats::sid_beta_c];</span></span>
<span id="L103"><span class="lineNum">     103</span> <span class="tlaGNC">           5 :       betaCutsQ  += stats.counters[Stats::sid_beta_q];</span></span>
<span id="L104"><span class="lineNum">     104</span> <span class="tlaGNC">           5 :       betaCutsBC += stats.counters[Stats::sid_beta_bc];</span></span>
<span id="L105"><span class="lineNum">     105</span> <span class="tlaGNC">           5 :    }</span></span>
<span id="L106"><span class="lineNum">     106</span>              : </span>
<span id="L107"><span class="lineNum">     107</span>              :    float percent(const Counter c) const { return c*100.f/betaCuts; }</span>
<span id="L108"><span class="lineNum">     108</span>              :    </span>
<span id="L109"><span class="lineNum">     109</span>              :    void show() const {</span>
<span id="L110"><span class="lineNum">     110</span>              : #ifdef WITH_BETACUTSTATS</span>
<span id="L111"><span class="lineNum">     111</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCuts   &quot; &lt;&lt; betaCuts;</span>
<span id="L112"><span class="lineNum">     112</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCutsTT &quot; &lt;&lt; betaCutsTT &lt;&lt; &quot; (&quot; &lt;&lt; percent(betaCutsTT) &lt;&lt; &quot;%)&quot;;</span>
<span id="L113"><span class="lineNum">     113</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCutsGC &quot; &lt;&lt; betaCutsGC &lt;&lt; &quot; (&quot; &lt;&lt; percent(betaCutsGC) &lt;&lt; &quot;%)&quot;;</span>
<span id="L114"><span class="lineNum">     114</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCutsP  &quot; &lt;&lt; betaCutsP  &lt;&lt; &quot; (&quot; &lt;&lt; percent(betaCutsP)  &lt;&lt; &quot;%)&quot;;</span>
<span id="L115"><span class="lineNum">     115</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCutsK1 &quot; &lt;&lt; betaCutsK1 &lt;&lt; &quot; (&quot; &lt;&lt; percent(betaCutsK1) &lt;&lt; &quot;%)&quot;;</span>
<span id="L116"><span class="lineNum">     116</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCutsK2 &quot; &lt;&lt; betaCutsK2 &lt;&lt; &quot; (&quot; &lt;&lt; percent(betaCutsK2) &lt;&lt; &quot;%)&quot;;</span>
<span id="L117"><span class="lineNum">     117</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCutsK3 &quot; &lt;&lt; betaCutsK3 &lt;&lt; &quot; (&quot; &lt;&lt; percent(betaCutsK3) &lt;&lt; &quot;%)&quot;;</span>
<span id="L118"><span class="lineNum">     118</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCutsK4 &quot; &lt;&lt; betaCutsK4 &lt;&lt; &quot; (&quot; &lt;&lt; percent(betaCutsK4) &lt;&lt; &quot;%)&quot;;</span>
<span id="L119"><span class="lineNum">     119</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCutsC  &quot; &lt;&lt; betaCutsC  &lt;&lt; &quot; (&quot; &lt;&lt; percent(betaCutsC)  &lt;&lt; &quot;%)&quot;;</span>
<span id="L120"><span class="lineNum">     120</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCutsQ  &quot; &lt;&lt; betaCutsQ  &lt;&lt; &quot; (&quot; &lt;&lt; percent(betaCutsQ)  &lt;&lt; &quot;%)&quot;;</span>
<span id="L121"><span class="lineNum">     121</span>              :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;betaCutsBC &quot; &lt;&lt; betaCutsBC &lt;&lt; &quot; (&quot; &lt;&lt; percent(betaCutsBC) &lt;&lt; &quot;%)&quot;;</span>
<span id="L122"><span class="lineNum">     122</span>              : #endif</span>
<span id="L123"><span class="lineNum">     123</span>              :    }</span>
<span id="L124"><span class="lineNum">     124</span>              : };</span>
<span id="L125"><span class="lineNum">     125</span>              : </span>
<span id="L126"><span class="lineNum">     126</span> <span class="tlaGNC">           1 : bool bench(DepthType depth) {</span></span>
<span id="L127"><span class="lineNum">     127</span> <span class="tlaGNC">           1 :    RootPosition p;</span></span>
<span id="L128"><span class="lineNum">     128</span>              : #ifdef WITH_NNUE</span>
<span id="L129"><span class="lineNum">     129</span> <span class="tlaGNC">           1 :    NNUEEvaluator evaluator;</span></span>
<span id="L130"><span class="lineNum">     130</span>              :    p.associateEvaluator(evaluator);</span>
<span id="L131"><span class="lineNum">     131</span>              : #endif</span>
<span id="L132"><span class="lineNum">     132</span>              : </span>
<span id="L133"><span class="lineNum">     133</span> <span class="tlaGNC">           1 :    BetaCutStat betaStats;</span></span>
<span id="L134"><span class="lineNum">     134</span>              : </span>
<span id="L135"><span class="lineNum">     135</span> <span class="tlaGNC">           1 :    auto pos = {startPosition, fine70, shirov, shirov2, mate4};</span></span>
<span id="L136"><span class="lineNum">     136</span>              : </span>
<span id="L137"><span class="lineNum">     137</span> <span class="tlaGNC">           6 :    for(const auto &amp; fen : pos){</span></span>
<span id="L138"><span class="lineNum">     138</span> <span class="tlaGNC">           5 :       readFEN(std::string{fen}, p);</span></span>
<span id="L139"><span class="lineNum">     139</span> <span class="tlaGNC">           5 :       analyze(p, depth, true);</span></span>
<span id="L140"><span class="lineNum">     140</span> <span class="tlaGNC">           5 :       betaStats.update(ThreadPool::instance().main().stats);</span></span>
<span id="L141"><span class="lineNum">     141</span>              :    }</span>
<span id="L142"><span class="lineNum">     142</span>              : </span>
<span id="L143"><span class="lineNum">     143</span>              :    betaStats.show();</span>
<span id="L144"><span class="lineNum">     144</span>              :    </span>
<span id="L145"><span class="lineNum">     145</span> <span class="tlaGNC">           1 :    return true;</span></span>
<span id="L146"><span class="lineNum">     146</span> <span class="tlaGNC">           1 : }</span></span>
<span id="L147"><span class="lineNum">     147</span>              : </span>
<span id="L148"><span class="lineNum">     148</span> <span class="tlaUNC tlaBgUNC">           0 : bool spsaInputs(){</span></span>
<span id="L149"><span class="lineNum">     149</span> <span class="tlaUNC">           0 :    Options::displayOptionsSPSA();</span></span>
<span id="L150"><span class="lineNum">     150</span> <span class="tlaUNC">           0 :    return true;</span></span>
<span id="L151"><span class="lineNum">     151</span>              : }</span>
<span id="L152"><span class="lineNum">     152</span>              : </span>
<span id="L153"><span class="lineNum">     153</span> <span class="tlaUNC">           0 : bool benchBig(DepthType depth){</span></span>
<span id="L154"><span class="lineNum">     154</span>              :    // use here same postitions set as Ethereal or Berserk</span>
<span id="L155"><span class="lineNum">     155</span>              :    static const std::vector&lt;std::string&gt; positions = {</span>
<span id="L156"><span class="lineNum">     156</span>              :       &quot;r3k2r/2pb1ppp/2pp1q2/p7/1nP1B3/1P2P3/P2N1PPP/R2QK2R w KQkq a6 0 14&quot;,</span>
<span id="L157"><span class="lineNum">     157</span>              :       &quot;4rrk1/2p1b1p1/p1p3q1/4p3/2P2n1p/1P1NR2P/PB3PP1/3R1QK1 b - - 2 24&quot;,</span>
<span id="L158"><span class="lineNum">     158</span>              :       &quot;r3qbrk/6p1/2b2pPp/p3pP1Q/PpPpP2P/3P1B2/2PB3K/R5R1 w - - 16 42&quot;,</span>
<span id="L159"><span class="lineNum">     159</span>              :       &quot;6k1/1R3p2/6p1/2Bp3p/3P2q1/P7/1P2rQ1K/5R2 b - - 4 44&quot;,</span>
<span id="L160"><span class="lineNum">     160</span>              :       &quot;8/8/1p2k1p1/3p3p/1p1P1P1P/1P2PK2/8/8 w - - 3 54&quot;,</span>
<span id="L161"><span class="lineNum">     161</span>              :       &quot;7r/2p3k1/1p1p1qp1/1P1Bp3/p1P2r1P/P7/4R3/Q4RK1 w - - 0 36&quot;,</span>
<span id="L162"><span class="lineNum">     162</span>              :       &quot;r1bq1rk1/pp2b1pp/n1pp1n2/3P1p2/2P1p3/2N1P2N/PP2BPPP/R1BQ1RK1 b - - 2 10&quot;,</span>
<span id="L163"><span class="lineNum">     163</span>              :       &quot;3r3k/2r4p/1p1b3q/p4P2/P2Pp3/1B2P3/3BQ1RP/6K1 w - - 3 87&quot;,</span>
<span id="L164"><span class="lineNum">     164</span>              :       &quot;2r4r/1p4k1/1Pnp4/3Qb1pq/8/4BpPp/5P2/2RR1BK1 w - - 0 42&quot;,</span>
<span id="L165"><span class="lineNum">     165</span>              :       &quot;4q1bk/6b1/7p/p1p4p/PNPpP2P/KN4P1/3Q4/4R3 b - - 0 37&quot;,</span>
<span id="L166"><span class="lineNum">     166</span>              :       &quot;2q3r1/1r2pk2/pp3pp1/2pP3p/P1Pb1BbP/1P4Q1/R3NPP1/4R1K1 w - - 2 34&quot;,</span>
<span id="L167"><span class="lineNum">     167</span>              :       &quot;1r2r2k/1b4q1/pp5p/2pPp1p1/P3Pn2/1P1B1Q1P/2R3P1/4BR1K b - - 1 37&quot;,</span>
<span id="L168"><span class="lineNum">     168</span>              :       &quot;r3kbbr/pp1n1p1P/3ppnp1/q5N1/1P1pP3/P1N1B3/2P1QP2/R3KB1R b KQkq b3 0 17&quot;,</span>
<span id="L169"><span class="lineNum">     169</span>              :       &quot;8/6pk/2b1Rp2/3r4/1R1B2PP/P5K1/8/2r5 b - - 16 42&quot;,</span>
<span id="L170"><span class="lineNum">     170</span>              :       &quot;1r4k1/4ppb1/2n1b1qp/pB4p1/1n1BP1P1/7P/2PNQPK1/3RN3 w - - 8 29&quot;,</span>
<span id="L171"><span class="lineNum">     171</span>              :       &quot;8/p2B4/PkP5/4p1pK/4Pb1p/5P2/8/8 w - - 29 68&quot;,</span>
<span id="L172"><span class="lineNum">     172</span>              :       &quot;3r4/ppq1ppkp/4bnp1/2pN4/2P1P3/1P4P1/PQ3PBP/R4K2 b - - 2 20&quot;,</span>
<span id="L173"><span class="lineNum">     173</span>              :       &quot;5rr1/4n2k/4q2P/P1P2n2/3B1p2/4pP2/2N1P3/1RR1K2Q w - - 1 49&quot;,</span>
<span id="L174"><span class="lineNum">     174</span>              :       &quot;1r5k/2pq2p1/3p3p/p1pP4/4QP2/PP1R3P/6PK/8 w - - 1 51&quot;,</span>
<span id="L175"><span class="lineNum">     175</span>              :       &quot;q5k1/5ppp/1r3bn1/1B6/P1N2P2/BQ2P1P1/5K1P/8 b - - 2 34&quot;,</span>
<span id="L176"><span class="lineNum">     176</span>              :       &quot;r1b2k1r/5n2/p4q2/1ppn1Pp1/3pp1p1/NP2P3/P1PPBK2/1RQN2R1 w - - 0 22&quot;,</span>
<span id="L177"><span class="lineNum">     177</span>              :       &quot;r1bqk2r/pppp1ppp/5n2/4b3/4P3/P1N5/1PP2PPP/R1BQKB1R w KQkq - 0 5&quot;,</span>
<span id="L178"><span class="lineNum">     178</span>              :       &quot;r1bqr1k1/pp1p1ppp/2p5/8/3N1Q2/P2BB3/1PP2PPP/R3K2n b Q - 1 12&quot;,</span>
<span id="L179"><span class="lineNum">     179</span>              :       &quot;r1bq2k1/p4r1p/1pp2pp1/3p4/1P1B3Q/P2B1N2/2P3PP/4R1K1 b - - 2 19&quot;,</span>
<span id="L180"><span class="lineNum">     180</span>              :       &quot;r4qk1/6r1/1p4p1/2ppBbN1/1p5Q/P7/2P3PP/5RK1 w - - 2 25&quot;,</span>
<span id="L181"><span class="lineNum">     181</span>              :       &quot;r7/6k1/1p6/2pp1p2/7Q/8/p1P2K1P/8 w - - 0 32&quot;,</span>
<span id="L182"><span class="lineNum">     182</span>              :       &quot;r3k2r/ppp1pp1p/2nqb1pn/3p4/4P3/2PP4/PP1NBPPP/R2QK1NR w KQkq - 1 5&quot;,</span>
<span id="L183"><span class="lineNum">     183</span>              :       &quot;3r1rk1/1pp1pn1p/p1n1q1p1/3p4/Q3P3/2P5/PP1NBPPP/4RRK1 w - - 0 12&quot;,</span>
<span id="L184"><span class="lineNum">     184</span>              :       &quot;5rk1/1pp1pn1p/p3Brp1/8/1n6/5N2/PP3PPP/2R2RK1 w - - 2 20&quot;,</span>
<span id="L185"><span class="lineNum">     185</span>              :       &quot;8/1p2pk1p/p1p1r1p1/3n4/8/5R2/PP3PPP/4R1K1 b - - 3 27&quot;,</span>
<span id="L186"><span class="lineNum">     186</span>              :       &quot;8/4pk2/1p1r2p1/p1p4p/Pn5P/3R4/1P3PP1/4RK2 w - - 1 33&quot;,</span>
<span id="L187"><span class="lineNum">     187</span>              :       &quot;8/5k2/1pnrp1p1/p1p4p/P6P/4R1PK/1P3P2/4R3 b - - 1 38&quot;,</span>
<span id="L188"><span class="lineNum">     188</span>              :       &quot;8/8/1p1kp1p1/p1pr1n1p/P6P/1R4P1/1P3PK1/1R6 b - - 15 45&quot;,</span>
<span id="L189"><span class="lineNum">     189</span>              :       &quot;8/8/1p1k2p1/p1prp2p/P2n3P/6P1/1P1R1PK1/4R3 b - - 5 49&quot;,</span>
<span id="L190"><span class="lineNum">     190</span>              :       &quot;8/8/1p4p1/p1p2k1p/P2npP1P/4K1P1/1P6/3R4 w - - 6 54&quot;,</span>
<span id="L191"><span class="lineNum">     191</span>              :       &quot;8/8/1p4p1/p1p2k1p/P2n1P1P/4K1P1/1P6/6R1 b - - 6 59&quot;,</span>
<span id="L192"><span class="lineNum">     192</span>              :       &quot;8/5k2/1p4p1/p1pK3p/P2n1P1P/6P1/1P6/4R3 b - - 14 63&quot;,</span>
<span id="L193"><span class="lineNum">     193</span>              :       &quot;8/1R6/1p1K1kp1/p6p/P1p2P1P/6P1/1Pn5/8 w - - 0 67&quot;,</span>
<span id="L194"><span class="lineNum">     194</span>              :       &quot;1rb1rn1k/p3q1bp/2p3p1/2p1p3/2P1P2N/PP1RQNP1/1B3P2/4R1K1 b - - 4 23&quot;,</span>
<span id="L195"><span class="lineNum">     195</span>              :       &quot;4rrk1/pp1n1pp1/q5p1/P1pP4/2n3P1/7P/1P3PB1/R1BQ1RK1 w - - 3 22&quot;,</span>
<span id="L196"><span class="lineNum">     196</span>              :       &quot;r2qr1k1/pb1nbppp/1pn1p3/2ppP3/3P4/2PB1NN1/PP3PPP/R1BQR1K1 w - - 4 12&quot;,</span>
<span id="L197"><span class="lineNum">     197</span>              :       &quot;2r2k2/8/4P1R1/1p6/8/P4K1N/7b/2B5 b - - 0 55&quot;,</span>
<span id="L198"><span class="lineNum">     198</span>              :       &quot;6k1/5pp1/8/2bKP2P/2P5/p4PNb/B7/8 b - - 1 44&quot;,</span>
<span id="L199"><span class="lineNum">     199</span>              :       &quot;2rqr1k1/1p3p1p/p2p2p1/P1nPb3/2B1P3/5P2/1PQ2NPP/R1R4K w - - 3 25&quot;,</span>
<span id="L200"><span class="lineNum">     200</span>              :       &quot;r1b2rk1/p1q1ppbp/6p1/2Q5/8/4BP2/PPP3PP/2KR1B1R b - - 2 14&quot;,</span>
<span id="L201"><span class="lineNum">     201</span>              :       &quot;6r1/5k2/p1b1r2p/1pB1p1p1/1Pp3PP/2P1R1K1/2P2P2/3R4 w - - 1 36&quot;,</span>
<span id="L202"><span class="lineNum">     202</span>              :       &quot;rnbqkb1r/pppppppp/5n2/8/2PP4/8/PP2PPPP/RNBQKBNR b KQkq c3 0 2&quot;,</span>
<span id="L203"><span class="lineNum">     203</span>              :       &quot;2rr2k1/1p4bp/p1q1p1p1/4Pp1n/2PB4/1PN3P1/P3Q2P/2RR2K1 w - f6 0 20&quot;,</span>
<span id="L204"><span class="lineNum">     204</span>              :       &quot;3br1k1/p1pn3p/1p3n2/5pNq/2P1p3/1PN3PP/P2Q1PB1/4R1K1 w - - 0 23&quot;,</span>
<span id="L205"><span class="lineNum">     205</span>              :       &quot;2r2b2/5p2/5k2/p1r1pP2/P2pB3/1P3P2/K1P3R1/7R w - - 23 93&quot;      </span>
<span id="L206"><span class="lineNum">     206</span> <span class="tlaUNC">           0 :    };</span></span>
<span id="L207"><span class="lineNum">     207</span>              : </span>
<span id="L208"><span class="lineNum">     208</span> <span class="tlaUNC">           0 :    RootPosition p;</span></span>
<span id="L209"><span class="lineNum">     209</span>              : #ifdef WITH_NNUE</span>
<span id="L210"><span class="lineNum">     210</span> <span class="tlaUNC">           0 :    NNUEEvaluator evaluator;</span></span>
<span id="L211"><span class="lineNum">     211</span>              :    p.associateEvaluator(evaluator);</span>
<span id="L212"><span class="lineNum">     212</span>              : #endif</span>
<span id="L213"><span class="lineNum">     213</span>              : </span>
<span id="L214"><span class="lineNum">     214</span> <span class="tlaUNC">           0 :    BetaCutStat betaStats;</span></span>
<span id="L215"><span class="lineNum">     215</span>              : </span>
<span id="L216"><span class="lineNum">     216</span> <span class="tlaUNC">           0 :    for( const auto &amp; fen : positions){</span></span>
<span id="L217"><span class="lineNum">     217</span> <span class="tlaUNC">           0 :       readFEN(fen, p);</span></span>
<span id="L218"><span class="lineNum">     218</span> <span class="tlaUNC">           0 :       analyze(p, depth, true);</span></span>
<span id="L219"><span class="lineNum">     219</span> <span class="tlaUNC">           0 :       betaStats.update(ThreadPool::instance().main().stats);</span></span>
<span id="L220"><span class="lineNum">     220</span>              :    }</span>
<span id="L221"><span class="lineNum">     221</span>              : </span>
<span id="L222"><span class="lineNum">     222</span>              :    betaStats.show();</span>
<span id="L223"><span class="lineNum">     223</span>              :    </span>
<span id="L224"><span class="lineNum">     224</span> <span class="tlaUNC">           0 :    return true;</span></span>
<span id="L225"><span class="lineNum">     225</span> <span class="tlaUNC">           0 : }</span></span>
<span id="L226"><span class="lineNum">     226</span>              : </span>
<span id="L227"><span class="lineNum">     227</span> <span class="tlaGNC tlaBgGNC">           8 : bool cliManagement(const std::string &amp; firstArg, int argc, char** argv) {</span></span>
<span id="L228"><span class="lineNum">     228</span>              :    </span>
<span id="L229"><span class="lineNum">     229</span>              :    // first we will look for options that do not need extra parameters</span>
<span id="L230"><span class="lineNum">     230</span>              : </span>
<span id="L231"><span class="lineNum">     231</span>              : #ifdef WITH_UCI</span>
<span id="L232"><span class="lineNum">     232</span> <span class="tlaGNC">           8 :    if (firstArg == &quot;-uci&quot;) {</span></span>
<span id="L233"><span class="lineNum">     233</span> <span class="tlaGNC">           1 :       UCI::init();</span></span>
<span id="L234"><span class="lineNum">     234</span> <span class="tlaGNC">           1 :       TimeMan::init();</span></span>
<span id="L235"><span class="lineNum">     235</span> <span class="tlaGNC">           1 :       UCI::uci();</span></span>
<span id="L236"><span class="lineNum">     236</span> <span class="tlaGNC">           1 :       return true;</span></span>
<span id="L237"><span class="lineNum">     237</span>              :    }</span>
<span id="L238"><span class="lineNum">     238</span> <span class="tlaGNC">           7 :    Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;You can use -uci command line option to enter uci mode&quot;;</span></span>
<span id="L239"><span class="lineNum">     239</span>              : #endif</span>
<span id="L240"><span class="lineNum">     240</span>              : #ifdef WITH_XBOARD</span>
<span id="L241"><span class="lineNum">     241</span> <span class="tlaGNC">           7 :    if (firstArg == &quot;-xboard&quot;) {</span></span>
<span id="L242"><span class="lineNum">     242</span> <span class="tlaGNC">           1 :       XBoard::init();</span></span>
<span id="L243"><span class="lineNum">     243</span> <span class="tlaGNC">           1 :       TimeMan::init();</span></span>
<span id="L244"><span class="lineNum">     244</span> <span class="tlaGNC">           1 :       XBoard::xboard();</span></span>
<span id="L245"><span class="lineNum">     245</span> <span class="tlaGNC">           1 :       return true;</span></span>
<span id="L246"><span class="lineNum">     246</span>              :    }</span>
<span id="L247"><span class="lineNum">     247</span> <span class="tlaGNC">           6 :    Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;You can use -xboard command line option to enter xboard mode&quot;;</span></span>
<span id="L248"><span class="lineNum">     248</span>              : #endif</span>
<span id="L249"><span class="lineNum">     249</span>              : </span>
<span id="L250"><span class="lineNum">     250</span>              : #ifdef WITH_FMTLIB   </span>
<span id="L251"><span class="lineNum">     251</span>              :    // let's switch to &quot;pretty mode&quot;</span>
<span id="L252"><span class="lineNum">     252</span>              :    Pretty::init();</span>
<span id="L253"><span class="lineNum">     253</span>              : #endif</span>
<span id="L254"><span class="lineNum">     254</span>              : </span>
<span id="L255"><span class="lineNum">     255</span>              :    const auto args {std::span(argv, size_t(argc))};</span>
<span id="L256"><span class="lineNum">     256</span>              : </span>
<span id="L257"><span class="lineNum">     257</span> <span class="tlaGNC">           6 :    if (firstArg == &quot;-selfplay&quot;) {</span></span>
<span id="L258"><span class="lineNum">     258</span>              :       DepthType d = 15; // this is &quot;search depth&quot;, not genFenDepth !</span>
<span id="L259"><span class="lineNum">     259</span> <span class="tlaGNC">           1 :       if (argc &gt; 2) d = clampDepth(atoi(args[2]));</span></span>
<span id="L260"><span class="lineNum">     260</span>              :       int64_t n = 1;</span>
<span id="L261"><span class="lineNum">     261</span> <span class="tlaGNC">           1 :       if (argc &gt; 3) n = atoll(args[3]);</span></span>
<span id="L262"><span class="lineNum">     262</span> <span class="tlaGNC">           1 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Let's go for &quot; &lt;&lt; n &lt;&lt; &quot; selfplay games ...&quot;;</span></span>
<span id="L263"><span class="lineNum">     263</span> <span class="tlaGNC">           1 :       const auto startTime = Clock::now();</span></span>
<span id="L264"><span class="lineNum">     264</span>              :       uint64_t nbGames = 0;</span>
<span id="L265"><span class="lineNum">     265</span>              :       uint64_t nbPos = 0;</span>
<span id="L266"><span class="lineNum">     266</span> <span class="tlaGNC">           2 :       while (n-- &gt; 0) {</span></span>
<span id="L267"><span class="lineNum">     267</span> <span class="tlaGNC">           2 :          if (n % 1000 == 0) Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Remaining games &quot; &lt;&lt; n;</span></span>
<span id="L268"><span class="lineNum">     268</span> <span class="tlaGNC">           1 :          uint64_t nbPosLoc = 0;</span></span>
<span id="L269"><span class="lineNum">     269</span> <span class="tlaGNC">           1 :          selfPlay(d, nbPosLoc);</span></span>
<span id="L270"><span class="lineNum">     270</span> <span class="tlaGNC">           1 :          nbPos += nbPosLoc;</span></span>
<span id="L271"><span class="lineNum">     271</span>              :          const auto ms = getTimeDiff(startTime);</span>
<span id="L272"><span class="lineNum">     272</span> <span class="tlaGNC">           1 :          ++nbGames;</span></span>
<span id="L273"><span class="lineNum">     273</span> <span class="tlaGNC">           1 :          Logging::LogIt(Logging::logError) &lt;&lt; &quot;Nb games : &quot; &lt;&lt; nbGames &lt;&lt; &quot;, Nb Pos : &quot; &lt;&lt; nbPos &lt;&lt; &quot;, elapsed s : &quot; &lt;&lt; ms/1000;</span></span>
<span id="L274"><span class="lineNum">     274</span> <span class="tlaGNC">           2 :          Logging::LogIt(Logging::logError) &lt;&lt; &quot;Game speed : &quot; &lt;&lt; static_cast&lt;double&gt;(nbGames) / (static_cast&lt;double&gt;(ms) / 1000 / 60) &lt;&lt; &quot; games/min&quot;;</span></span>
<span id="L275"><span class="lineNum">     275</span> <span class="tlaGNC">           2 :          Logging::LogIt(Logging::logError) &lt;&lt; &quot;Pos speed : &quot; &lt;&lt; static_cast&lt;double&gt;(nbPos) / (static_cast&lt;double&gt;(ms) / 1000) &lt;&lt; &quot; pos/s&quot;;         </span></span>
<span id="L276"><span class="lineNum">     276</span>              :       }</span>
<span id="L277"><span class="lineNum">     277</span>              :       return true;</span>
<span id="L278"><span class="lineNum">     278</span>              :    }</span>
<span id="L279"><span class="lineNum">     279</span>              : </span>
<span id="L280"><span class="lineNum">     280</span> <span class="tlaGNC">           5 :    if (firstArg == &quot;-perft_test&quot;) {</span></span>
<span id="L281"><span class="lineNum">     281</span>              :       bool ok = true;</span>
<span id="L282"><span class="lineNum">     282</span> <span class="tlaGNC">           1 :       ok |= perft_test(std::string(startPosition), 5, 4865609);</span></span>
<span id="L283"><span class="lineNum">     283</span> <span class="tlaGNC">           1 :       ok |= perft_test(&quot;r3k2r/p1ppqpb1/bn2pnp1/3PN3/1p2P3/2N2Q1p/PPPBBPPP/R3K2R w KQkq - &quot;, 4, 4085603);</span></span>
<span id="L284"><span class="lineNum">     284</span> <span class="tlaGNC">           1 :       ok |= perft_test(&quot;8/2p5/3p4/KP5r/1R3p1k/8/4P1P1/8 w - - &quot;, 6, 11030083);</span></span>
<span id="L285"><span class="lineNum">     285</span> <span class="tlaGNC">           1 :       ok |= perft_test(&quot;r3k2r/Pppp1ppp/1b3nbN/nP6/BBP1P3/q4N2/Pp1P2PP/R2Q1RK1 w kq - 0 1&quot;, 5, 15833292);</span></span>
<span id="L286"><span class="lineNum">     286</span> <span class="tlaGNC">           1 :       return ok;</span></span>
<span id="L287"><span class="lineNum">     287</span>              :    }</span>
<span id="L288"><span class="lineNum">     288</span>              : </span>
<span id="L289"><span class="lineNum">     289</span> <span class="tlaGNC">           4 :    if (firstArg == &quot;-perft_test_long_fischer&quot;) {</span></span>
<span id="L290"><span class="lineNum">     290</span>              :       bool ok = true;</span>
<span id="L291"><span class="lineNum">     291</span> <span class="tlaUNC tlaBgUNC">           0 :       DynamicConfig::FRC = true;</span></span>
<span id="L292"><span class="lineNum">     292</span> <span class="tlaUNC">           0 :       std::ifstream infile(&quot;Book_and_Test/TestSuite/fischer.txt&quot;);</span></span>
<span id="L293"><span class="lineNum">     293</span>              :       std::string   line;</span>
<span id="L294"><span class="lineNum">     294</span> <span class="tlaUNC">           0 :       while (std::getline(infile, line)) {</span></span>
<span id="L295"><span class="lineNum">     295</span>              :          std::size_t       found = line.find_first_of(&quot;,&quot;);</span>
<span id="L296"><span class="lineNum">     296</span> <span class="tlaUNC">           0 :          const std::string fen   = line.substr(0, found);</span></span>
<span id="L297"><span class="lineNum">     297</span> <span class="tlaUNC">           0 :          while (found != std::string::npos) {</span></span>
<span id="L298"><span class="lineNum">     298</span> <span class="tlaUNC">           0 :             const std::size_t start = found + 1;</span></span>
<span id="L299"><span class="lineNum">     299</span>              :             found                   = line.find_first_of(',', found + 1);</span>
<span id="L300"><span class="lineNum">     300</span> <span class="tlaUNC">           0 :             const uint64_t ull      = std::stoull(line.substr(start, found - start));</span></span>
<span id="L301"><span class="lineNum">     301</span> <span class="tlaUNC">           0 :             ok |= perft_test(fen, 6, ull);</span></span>
<span id="L302"><span class="lineNum">     302</span>              :          }</span>
<span id="L303"><span class="lineNum">     303</span>              :       }</span>
<span id="L304"><span class="lineNum">     304</span>              :       return ok;</span>
<span id="L305"><span class="lineNum">     305</span> <span class="tlaUNC">           0 :    }</span></span>
<span id="L306"><span class="lineNum">     306</span>              : </span>
<span id="L307"><span class="lineNum">     307</span> <span class="tlaGNC tlaBgGNC">           4 :    if (firstArg == &quot;-perft_test_long&quot;) {</span></span>
<span id="L308"><span class="lineNum">     308</span>              :       bool ok = true;</span>
<span id="L309"><span class="lineNum">     309</span> <span class="tlaUNC tlaBgUNC">           0 :       std::ifstream infile(&quot;Book_and_Test/TestSuite/perft.txt&quot;);</span></span>
<span id="L310"><span class="lineNum">     310</span>              :       std::string   line;</span>
<span id="L311"><span class="lineNum">     311</span> <span class="tlaUNC">           0 :       while (std::getline(infile, line)) {</span></span>
<span id="L312"><span class="lineNum">     312</span>              :          std::size_t       found = line.find_first_of(&quot;,&quot;);</span>
<span id="L313"><span class="lineNum">     313</span> <span class="tlaUNC">           0 :          const std::string fen   = line.substr(0, found);</span></span>
<span id="L314"><span class="lineNum">     314</span>              :          DepthType         i     = 0;</span>
<span id="L315"><span class="lineNum">     315</span> <span class="tlaUNC">           0 :          while (found != std::string::npos) {</span></span>
<span id="L316"><span class="lineNum">     316</span> <span class="tlaUNC">           0 :             const std::size_t start = found + 1;</span></span>
<span id="L317"><span class="lineNum">     317</span>              :             found                   = line.find_first_of(',', found + 1);</span>
<span id="L318"><span class="lineNum">     318</span> <span class="tlaUNC">           0 :             const uint64_t ull      = std::stoull(line.substr(start, found - start));</span></span>
<span id="L319"><span class="lineNum">     319</span> <span class="tlaUNC">           0 :             ok |= perft_test(fen, ++i, ull);</span></span>
<span id="L320"><span class="lineNum">     320</span>              :          }</span>
<span id="L321"><span class="lineNum">     321</span>              :       }</span>
<span id="L322"><span class="lineNum">     322</span>              :       return ok;</span>
<span id="L323"><span class="lineNum">     323</span> <span class="tlaUNC">           0 :    }</span></span>
<span id="L324"><span class="lineNum">     324</span>              : </span>
<span id="L325"><span class="lineNum">     325</span> <span class="tlaGNC tlaBgGNC">           4 :    if (firstArg == &quot;-see_test&quot;) {</span></span>
<span id="L326"><span class="lineNum">     326</span> <span class="tlaUNC tlaBgUNC">           0 :       return TestSEE();</span></span>
<span id="L327"><span class="lineNum">     327</span>              :    }</span>
<span id="L328"><span class="lineNum">     328</span>              : </span>
<span id="L329"><span class="lineNum">     329</span> <span class="tlaGNC tlaBgGNC">           4 :    if (firstArg == &quot;bench&quot; || firstArg == &quot;-bench&quot;) {</span></span>
<span id="L330"><span class="lineNum">     330</span>              :       DepthType d = 16;</span>
<span id="L331"><span class="lineNum">     331</span> <span class="tlaGNC">           2 :       if (argc &gt; 2) d = clampDepth(atoi(args[2]));</span></span>
<span id="L332"><span class="lineNum">     332</span> <span class="tlaGNC">           1 :       return bench(d);</span></span>
<span id="L333"><span class="lineNum">     333</span>              :    }</span>
<span id="L334"><span class="lineNum">     334</span>              : </span>
<span id="L335"><span class="lineNum">     335</span> <span class="tlaGNC">           3 :    if (firstArg == &quot;spsa&quot; || firstArg == &quot;-spsa&quot;) {</span></span>
<span id="L336"><span class="lineNum">     336</span>              :       return spsaInputs();</span>
<span id="L337"><span class="lineNum">     337</span>              :    }</span>
<span id="L338"><span class="lineNum">     338</span>              : </span>
<span id="L339"><span class="lineNum">     339</span> <span class="tlaGNC">           3 :    if (firstArg == &quot;benchBig&quot; || firstArg == &quot;-benchBig&quot;) {</span></span>
<span id="L340"><span class="lineNum">     340</span>              :       DepthType d = 16;</span>
<span id="L341"><span class="lineNum">     341</span> <span class="tlaUNC tlaBgUNC">           0 :       if (argc &gt; 2) d = clampDepth(atoi(args[2]));</span></span>
<span id="L342"><span class="lineNum">     342</span> <span class="tlaUNC">           0 :       return benchBig(d);</span></span>
<span id="L343"><span class="lineNum">     343</span>              :    }</span>
<span id="L344"><span class="lineNum">     344</span>              : </span>
<span id="L345"><span class="lineNum">     345</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-evalSpeed&quot;) {</span></span>
<span id="L346"><span class="lineNum">     346</span> <span class="tlaUNC tlaBgUNC">           0 :       DynamicConfig::disableTT = true;</span></span>
<span id="L347"><span class="lineNum">     347</span> <span class="tlaUNC">           0 :       std::string filename     = &quot;Book_and_Test/TestSuite/evalSpeed.epd&quot;;</span></span>
<span id="L348"><span class="lineNum">     348</span> <span class="tlaUNC">           0 :       if (argc &gt; 2) filename = args[2];</span></span>
<span id="L349"><span class="lineNum">     349</span> <span class="tlaUNC">           0 :       std::vector&lt;RootPosition&gt; data;</span></span>
<span id="L350"><span class="lineNum">     350</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Running eval speed with file (including NNUE evaluator reset)&quot; &lt;&lt; filename;</span></span>
<span id="L351"><span class="lineNum">     351</span> <span class="tlaUNC">           0 :       std::vector&lt;std::string&gt; positions;</span></span>
<span id="L352"><span class="lineNum">     352</span> <span class="tlaUNC">           0 :       DISCARD                  readEPDFile(filename, positions);</span></span>
<span id="L353"><span class="lineNum">     353</span> <span class="tlaUNC">           0 :       for (size_t k = 0; k &lt; positions.size(); ++k) {</span></span>
<span id="L354"><span class="lineNum">     354</span> <span class="tlaUNC">           0 :          data.emplace_back(positions[k], false);</span></span>
<span id="L355"><span class="lineNum">     355</span> <span class="tlaUNC">           0 :          if (k % 50000 == 0) Logging::LogIt(Logging::logInfo) &lt;&lt; k &lt;&lt; &quot; position read&quot;;</span></span>
<span id="L356"><span class="lineNum">     356</span>              :       }</span>
<span id="L357"><span class="lineNum">     357</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Data size : &quot; &lt;&lt; data.size();</span></span>
<span id="L358"><span class="lineNum">     358</span>              : </span>
<span id="L359"><span class="lineNum">     359</span> <span class="tlaUNC">           0 :       std::chrono::time_point&lt;Clock&gt; startTime = Clock::now();</span></span>
<span id="L360"><span class="lineNum">     360</span>              :       const int loops = 10;</span>
<span id="L361"><span class="lineNum">     361</span> <span class="tlaUNC">           0 :       for (int k = 0; k &lt; loops; ++k)</span></span>
<span id="L362"><span class="lineNum">     362</span> <span class="tlaUNC">           0 :          for (auto&amp; p : data) {</span></span>
<span id="L363"><span class="lineNum">     363</span>              : #ifdef WITH_NNUE</span>
<span id="L364"><span class="lineNum">     364</span> <span class="tlaUNC">           0 :             NNUEEvaluator evaluator;</span></span>
<span id="L365"><span class="lineNum">     365</span>              :             p.associateEvaluator(evaluator);</span>
<span id="L366"><span class="lineNum">     366</span> <span class="tlaUNC">           0 :             p.resetNNUEEvaluator(evaluator);</span></span>
<span id="L367"><span class="lineNum">     367</span>              : #endif</span>
<span id="L368"><span class="lineNum">     368</span> <span class="tlaUNC">           0 :             EvalData d;</span></span>
<span id="L369"><span class="lineNum">     369</span> <span class="tlaUNC">           0 :             DISCARD eval(p, d, ThreadPool::instance().main(), true);</span></span>
<span id="L370"><span class="lineNum">     370</span>              :          }</span>
<span id="L371"><span class="lineNum">     371</span>              :       auto ms = getTimeDiff(startTime);</span>
<span id="L372"><span class="lineNum">     372</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Eval speed (with EG material hash): &quot; &lt;&lt; static_cast&lt;double&gt;(data.size()) * loops / (static_cast&lt;double&gt;(ms) * 1000) &lt;&lt; &quot; Meval/s&quot;;</span></span>
<span id="L373"><span class="lineNum">     373</span>              : </span>
<span id="L374"><span class="lineNum">     374</span> <span class="tlaUNC">           0 :       startTime = Clock::now();</span></span>
<span id="L375"><span class="lineNum">     375</span> <span class="tlaUNC">           0 :       for (int k = 0; k &lt; loops; ++k)</span></span>
<span id="L376"><span class="lineNum">     376</span> <span class="tlaUNC">           0 :          for (auto&amp; p : data) {</span></span>
<span id="L377"><span class="lineNum">     377</span>              : #ifdef WITH_NNUE</span>
<span id="L378"><span class="lineNum">     378</span> <span class="tlaUNC">           0 :             NNUEEvaluator evaluator;</span></span>
<span id="L379"><span class="lineNum">     379</span>              :             p.associateEvaluator(evaluator);</span>
<span id="L380"><span class="lineNum">     380</span> <span class="tlaUNC">           0 :             p.resetNNUEEvaluator(evaluator);</span></span>
<span id="L381"><span class="lineNum">     381</span>              : #endif</span>
<span id="L382"><span class="lineNum">     382</span> <span class="tlaUNC">           0 :             EvalData d;</span></span>
<span id="L383"><span class="lineNum">     383</span> <span class="tlaUNC">           0 :             DISCARD eval(p, d, ThreadPool::instance().main(), false);</span></span>
<span id="L384"><span class="lineNum">     384</span>              :          }</span>
<span id="L385"><span class="lineNum">     385</span>              :       ms = getTimeDiff(startTime);</span>
<span id="L386"><span class="lineNum">     386</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Eval speed : &quot; &lt;&lt; static_cast&lt;double&gt;(data.size()) * loops / (static_cast&lt;double&gt;(ms) * 1000) &lt;&lt; &quot; Meval/s&quot;;</span></span>
<span id="L387"><span class="lineNum">     387</span>              : </span>
<span id="L388"><span class="lineNum">     388</span> <span class="tlaUNC">           0 :       ThreadPool::instance().displayStats();</span></span>
<span id="L389"><span class="lineNum">     389</span>              :       return true;</span>
<span id="L390"><span class="lineNum">     390</span> <span class="tlaUNC">           0 :    }</span></span>
<span id="L391"><span class="lineNum">     391</span>              : </span>
<span id="L392"><span class="lineNum">     392</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-timeTest&quot;) {</span></span>
<span id="L393"><span class="lineNum">     393</span>              :       TimeMan::TCType tcType      = TimeMan::TC_suddendeath;</span>
<span id="L394"><span class="lineNum">     394</span>              :       TimeType        initialTime = 50000;</span>
<span id="L395"><span class="lineNum">     395</span>              :       TimeType        increment   = 0;</span>
<span id="L396"><span class="lineNum">     396</span>              :       int             movesInTC   = -1;</span>
<span id="L397"><span class="lineNum">     397</span>              :       TimeType        guiLag      = 0;</span>
<span id="L398"><span class="lineNum">     398</span> <span class="tlaUNC tlaBgUNC">           0 :       if (argc &gt; 2) initialTime = atoi(args[2]);</span></span>
<span id="L399"><span class="lineNum">     399</span> <span class="tlaUNC">           0 :       if (argc &gt; 3) increment   = atoi(args[3]);</span></span>
<span id="L400"><span class="lineNum">     400</span> <span class="tlaUNC">           0 :       if (argc &gt; 4) movesInTC   = atoi(args[4]);</span></span>
<span id="L401"><span class="lineNum">     401</span> <span class="tlaUNC">           0 :       if (argc &gt; 5) guiLag      = atoi(args[5]);</span></span>
<span id="L402"><span class="lineNum">     402</span> <span class="tlaUNC">           0 :       TimeMan::simulate(tcType, initialTime, increment, movesInTC, guiLag);</span></span>
<span id="L403"><span class="lineNum">     403</span> <span class="tlaUNC">           0 :       return true;</span></span>
<span id="L404"><span class="lineNum">     404</span>              :    }</span>
<span id="L405"><span class="lineNum">     405</span>              : </span>
<span id="L406"><span class="lineNum">     406</span>              :    // in all other cases, args[2] is always the fen string</span>
<span id="L407"><span class="lineNum">     407</span> <span class="tlaGNC tlaBgGNC">           3 :    if(argc &lt; 3){</span></span>
<span id="L408"><span class="lineNum">     408</span> <span class="tlaUNC tlaBgUNC">           0 :       Logging::LogIt(Logging::logError) &lt;&lt; &quot;your command is either wrong or needs a fen string&quot;;</span></span>
<span id="L409"><span class="lineNum">     409</span> <span class="tlaUNC">           0 :       return true;</span></span>
<span id="L410"><span class="lineNum">     410</span>              :    }</span>
<span id="L411"><span class="lineNum">     411</span> <span class="tlaGNC tlaBgGNC">           3 :    std::string fen = args[2];</span></span>
<span id="L412"><span class="lineNum">     412</span>              : </span>
<span id="L413"><span class="lineNum">     413</span>              :    // some &quot;short cuts&quot; !</span>
<span id="L414"><span class="lineNum">     414</span> <span class="tlaGNC">           3 :    if (fen == &quot;start&quot;) fen = startPosition;</span></span>
<span id="L415"><span class="lineNum">     415</span> <span class="tlaGNC">           3 :    if (fen == &quot;fine70&quot;) fen = fine70;</span></span>
<span id="L416"><span class="lineNum">     416</span> <span class="tlaGNC">           3 :    if (fen == &quot;shirov&quot;) fen = shirov;</span></span>
<span id="L417"><span class="lineNum">     417</span> <span class="tlaGNC">           3 :    if (fen == &quot;shirov2&quot;) fen = shirov2;</span></span>
<span id="L418"><span class="lineNum">     418</span> <span class="tlaGNC">           3 :    if (fen == &quot;mate4&quot;) fen = mate4;</span></span>
<span id="L419"><span class="lineNum">     419</span>              : </span>
<span id="L420"><span class="lineNum">     420</span>              :    // validate the supposed fen string ...</span>
<span id="L421"><span class="lineNum">     421</span>              :    const std::regex lookLikeFen(</span>
<span id="L422"><span class="lineNum">     422</span>              :     &quot;^&quot;</span>
<span id="L423"><span class="lineNum">     423</span>              :     &quot;([rnbqkpRNBQKP1-8]+\\/){7}([rnbqkpRNBQKP1-8]+)\\s&quot;</span>
<span id="L424"><span class="lineNum">     424</span>              :     &quot;[bw]\\s&quot;</span>
<span id="L425"><span class="lineNum">     425</span>              :     &quot;((-|(K|[A-H])?(Q|[A-H])?(k|[a-h])?(q|[a-h])?)\\s)&quot;</span>
<span id="L426"><span class="lineNum">     426</span>              :     &quot;((-|[a-h][36])\\s)&quot;</span>
<span id="L427"><span class="lineNum">     427</span>              :     &quot;((\\d+)\\s(\\d+)\\s?|(\\d+)\\s?)?&quot;</span>
<span id="L428"><span class="lineNum">     428</span>              :     &quot;$&quot;</span>
<span id="L429"><span class="lineNum">     429</span> <span class="tlaGNC">           3 :    );</span></span>
<span id="L430"><span class="lineNum">     430</span> <span class="tlaGNC">           3 :    if( ! std::regex_match(fen, lookLikeFen)){</span></span>
<span id="L431"><span class="lineNum">     431</span> <span class="tlaUNC tlaBgUNC">           0 :       Logging::LogIt(Logging::logError) &lt;&lt; &quot;fen does not look good... : &quot; &lt;&lt; fen;</span></span>
<span id="L432"><span class="lineNum">     432</span> <span class="tlaUNC">           0 :       return true;</span></span>
<span id="L433"><span class="lineNum">     433</span>              :    }</span>
<span id="L434"><span class="lineNum">     434</span>              : </span>
<span id="L435"><span class="lineNum">     435</span>              :    // instantiate the position</span>
<span id="L436"><span class="lineNum">     436</span> <span class="tlaGNC tlaBgGNC">           3 :    RootPosition p;</span></span>
<span id="L437"><span class="lineNum">     437</span>              : #ifdef WITH_NNUE</span>
<span id="L438"><span class="lineNum">     438</span> <span class="tlaGNC">           3 :    NNUEEvaluator evaluator;</span></span>
<span id="L439"><span class="lineNum">     439</span>              :    p.associateEvaluator(evaluator);</span>
<span id="L440"><span class="lineNum">     440</span>              : #endif</span>
<span id="L441"><span class="lineNum">     441</span> <span class="tlaGNC">           3 :    if (!readFEN(fen, p, false, true)) {</span></span>
<span id="L442"><span class="lineNum">     442</span> <span class="tlaUNC tlaBgUNC">           0 :       Logging::LogIt(Logging::logError) &lt;&lt; &quot;when reading fen&quot;;</span></span>
<span id="L443"><span class="lineNum">     443</span> <span class="tlaUNC">           0 :       return true;</span></span>
<span id="L444"><span class="lineNum">     444</span>              :    }</span>
<span id="L445"><span class="lineNum">     445</span>              : </span>
<span id="L446"><span class="lineNum">     446</span> <span class="tlaGNC tlaBgGNC">           6 :    Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(p);</span></span>
<span id="L447"><span class="lineNum">     447</span>              : </span>
<span id="L448"><span class="lineNum">     448</span> <span class="tlaGNC">           3 :    if (firstArg == &quot;-qsearch&quot;) {</span></span>
<span id="L449"><span class="lineNum">     449</span> <span class="tlaUNC tlaBgUNC">           0 :       DepthType seldepth = 0;</span></span>
<span id="L450"><span class="lineNum">     450</span> <span class="tlaUNC">           0 :       ScoreType s        = ThreadPool::instance().main().qsearchNoPruning(-10000, 10000, p, 1, seldepth);</span></span>
<span id="L451"><span class="lineNum">     451</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;QScore &quot; &lt;&lt; s;</span></span>
<span id="L452"><span class="lineNum">     452</span>              :       return true;</span>
<span id="L453"><span class="lineNum">     453</span>              :    }</span>
<span id="L454"><span class="lineNum">     454</span>              : </span>
<span id="L455"><span class="lineNum">     455</span>              : #ifdef WITH_SYZYGY</span>
<span id="L456"><span class="lineNum">     456</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-probe&quot;){</span></span>
<span id="L457"><span class="lineNum">     457</span> <span class="tlaUNC tlaBgUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Probing TB&quot;;</span></span>
<span id="L458"><span class="lineNum">     458</span> <span class="tlaUNC">           0 :       if ((BB::countBit(p.allPieces[Co_White] | p.allPieces[Co_Black])) &lt;= SyzygyTb::MAX_TB_MEN) {</span></span>
<span id="L459"><span class="lineNum">     459</span> <span class="tlaUNC">           0 :          ScoreType tbScore = 0;</span></span>
<span id="L460"><span class="lineNum">     460</span> <span class="tlaUNC">           0 :          Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Probing root&quot;;</span></span>
<span id="L461"><span class="lineNum">     461</span> <span class="tlaUNC">           0 :          if (MoveList movesTB; SyzygyTb::probe_root(ThreadPool::instance().main(), p, tbScore, movesTB) &gt;= 0) { // only good moves if TB success</span></span>
<span id="L462"><span class="lineNum">     462</span> <span class="tlaUNC">           0 :             for (auto m : movesTB ){</span></span>
<span id="L463"><span class="lineNum">     463</span> <span class="tlaUNC">           0 :                Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;TB move &quot; &lt;&lt; ToString(m);</span></span>
<span id="L464"><span class="lineNum">     464</span>              :             }</span>
<span id="L465"><span class="lineNum">     465</span> <span class="tlaUNC">           0 :             Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Score &quot; &lt;&lt; tbScore;</span></span>
<span id="L466"><span class="lineNum">     466</span>              :          }</span>
<span id="L467"><span class="lineNum">     467</span>              :          else {</span>
<span id="L468"><span class="lineNum">     468</span> <span class="tlaUNC">           0 :             Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;TB failed&quot;;</span></span>
<span id="L469"><span class="lineNum">     469</span>              :          }</span>
<span id="L470"><span class="lineNum">     470</span> <span class="tlaUNC">           0 :          Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Probing wdl&quot;;</span></span>
<span id="L471"><span class="lineNum">     471</span> <span class="tlaUNC">           0 :          if (SyzygyTb::probe_wdl(p, tbScore, false) &gt; 0) {</span></span>
<span id="L472"><span class="lineNum">     472</span> <span class="tlaUNC">           0 :             Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Score &quot; &lt;&lt; tbScore;</span></span>
<span id="L473"><span class="lineNum">     473</span>              :          }</span>
<span id="L474"><span class="lineNum">     474</span>              :          else {</span>
<span id="L475"><span class="lineNum">     475</span> <span class="tlaUNC">           0 :             Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;TB failed&quot;;</span></span>
<span id="L476"><span class="lineNum">     476</span>              :          }</span>
<span id="L477"><span class="lineNum">     477</span>              :       }</span>
<span id="L478"><span class="lineNum">     478</span>              :       else {</span>
<span id="L479"><span class="lineNum">     479</span> <span class="tlaUNC">           0 :          Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;No TB hit&quot;;</span></span>
<span id="L480"><span class="lineNum">     480</span>              :       }</span>
<span id="L481"><span class="lineNum">     481</span> <span class="tlaUNC">           0 :       return true;</span></span>
<span id="L482"><span class="lineNum">     482</span>              :    }</span>
<span id="L483"><span class="lineNum">     483</span>              : #endif</span>
<span id="L484"><span class="lineNum">     484</span>              : </span>
<span id="L485"><span class="lineNum">     485</span> <span class="tlaGNC tlaBgGNC">           3 :    if ( firstArg == &quot;-kpk&quot;){</span></span>
<span id="L486"><span class="lineNum">     486</span> <span class="tlaUNC tlaBgUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Probing KPK&quot;;</span></span>
<span id="L487"><span class="lineNum">     487</span> <span class="tlaUNC">           0 :       const Color winningSide = p.pieces_const&lt;P_wp&gt;(Co_White) == emptyBitBoard ? Co_Black : Co_White;</span></span>
<span id="L488"><span class="lineNum">     488</span> <span class="tlaUNC">           0 :       std::cout &lt;&lt; &quot;KPK score : &quot; &lt;&lt; MaterialHash::helperKPK(p, winningSide, 0, 1) &lt;&lt; std::endl;</span></span>
<span id="L489"><span class="lineNum">     489</span>              :       return true;</span>
<span id="L490"><span class="lineNum">     490</span>              :    }</span>
<span id="L491"><span class="lineNum">     491</span>              : </span>
<span id="L492"><span class="lineNum">     492</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-see&quot;) {</span></span>
<span id="L493"><span class="lineNum">     493</span> <span class="tlaUNC tlaBgUNC">           0 :       Square from  = INVALIDSQUARE;</span></span>
<span id="L494"><span class="lineNum">     494</span> <span class="tlaUNC">           0 :       Square to    = INVALIDSQUARE;</span></span>
<span id="L495"><span class="lineNum">     495</span> <span class="tlaUNC">           0 :       MType  mtype = T_std;</span></span>
<span id="L496"><span class="lineNum">     496</span> <span class="tlaUNC">           0 :       const std::string move  = argc &gt; 3 ? args[3] : &quot;e2e4&quot;;</span></span>
<span id="L497"><span class="lineNum">     497</span> <span class="tlaUNC">           0 :       readMove(p, move, from, to, mtype);</span></span>
<span id="L498"><span class="lineNum">     498</span> <span class="tlaUNC">           0 :       Move      m = ToMove(from, to, mtype);</span></span>
<span id="L499"><span class="lineNum">     499</span> <span class="tlaUNC">           0 :       ScoreType t = clampInt&lt;ScoreType&gt;(atoi(args[4]));</span></span>
<span id="L500"><span class="lineNum">     500</span> <span class="tlaUNC">           0 :       bool      b = Searcher::SEE_GE(p, m, t);</span></span>
<span id="L501"><span class="lineNum">     501</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;SEE ? &quot; &lt;&lt; (b ? &quot;ok&quot; : &quot;not&quot;);</span></span>
<span id="L502"><span class="lineNum">     502</span>              :       return true;</span>
<span id="L503"><span class="lineNum">     503</span>              :    }</span>
<span id="L504"><span class="lineNum">     504</span>              : </span>
<span id="L505"><span class="lineNum">     505</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-attacked&quot;) {</span></span>
<span id="L506"><span class="lineNum">     506</span>              :       Square k = Sq_e4;</span>
<span id="L507"><span class="lineNum">     507</span> <span class="tlaUNC tlaBgUNC">           0 :       if (argc &gt; 3) k = clampIntU&lt;Square&gt;(atoi(args[3]));</span></span>
<span id="L508"><span class="lineNum">     508</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; SquareNames[k];</span></span>
<span id="L509"><span class="lineNum">     509</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::allAttackedBB(p, k, p.c));</span></span>
<span id="L510"><span class="lineNum">     510</span> <span class="tlaUNC">           0 :       return true;</span></span>
<span id="L511"><span class="lineNum">     511</span>              :    }</span>
<span id="L512"><span class="lineNum">     512</span>              : </span>
<span id="L513"><span class="lineNum">     513</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-cov&quot;) {</span></span>
<span id="L514"><span class="lineNum">     514</span>              :       Square k = Sq_e4;</span>
<span id="L515"><span class="lineNum">     515</span> <span class="tlaUNC tlaBgUNC">           0 :       if (argc &gt; 3) k = clampIntU&lt;Square&gt;(atoi(args[3]));</span></span>
<span id="L516"><span class="lineNum">     516</span> <span class="tlaUNC">           0 :       switch (p.board_const(k)) {</span></span>
<span id="L517"><span class="lineNum">     517</span> <span class="tlaUNC">           0 :          case P_wp: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString((BBTools::coverage&lt;P_wp&gt;(k, p.occupancy(), p.c) + BBTools::mask[k].push[p.c]) &amp;~p.allPieces[Co_White]); break;</span></span>
<span id="L518"><span class="lineNum">     518</span> <span class="tlaUNC">           0 :          case P_wn: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::coverage&lt;P_wn&gt;(k, p.occupancy(), p.c) &amp; ~p.allPieces[Co_White]); break;</span></span>
<span id="L519"><span class="lineNum">     519</span> <span class="tlaUNC">           0 :          case P_wb: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::coverage&lt;P_wb&gt;(k, p.occupancy(), p.c) &amp; ~p.allPieces[Co_White]); break;</span></span>
<span id="L520"><span class="lineNum">     520</span> <span class="tlaUNC">           0 :          case P_wr: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::coverage&lt;P_wr&gt;(k, p.occupancy(), p.c) &amp; ~p.allPieces[Co_White]); break;</span></span>
<span id="L521"><span class="lineNum">     521</span> <span class="tlaUNC">           0 :          case P_wq: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::coverage&lt;P_wq&gt;(k, p.occupancy(), p.c) &amp; ~p.allPieces[Co_White]); break;</span></span>
<span id="L522"><span class="lineNum">     522</span> <span class="tlaUNC">           0 :          case P_wk: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::coverage&lt;P_wk&gt;(k, p.occupancy(), p.c) &amp; ~p.allPieces[Co_White]); break;</span></span>
<span id="L523"><span class="lineNum">     523</span> <span class="tlaUNC">           0 :          case P_bk: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::coverage&lt;P_wk&gt;(k, p.occupancy(), p.c) &amp; ~p.allPieces[Co_Black]); break;</span></span>
<span id="L524"><span class="lineNum">     524</span> <span class="tlaUNC">           0 :          case P_bq: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::coverage&lt;P_wq&gt;(k, p.occupancy(), p.c) &amp; ~p.allPieces[Co_Black]); break;</span></span>
<span id="L525"><span class="lineNum">     525</span> <span class="tlaUNC">           0 :          case P_br: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::coverage&lt;P_wr&gt;(k, p.occupancy(), p.c) &amp; ~p.allPieces[Co_Black]); break;</span></span>
<span id="L526"><span class="lineNum">     526</span> <span class="tlaUNC">           0 :          case P_bb: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::coverage&lt;P_wb&gt;(k, p.occupancy(), p.c) &amp; ~p.allPieces[Co_Black]); break;</span></span>
<span id="L527"><span class="lineNum">     527</span> <span class="tlaUNC">           0 :          case P_bn: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(BBTools::coverage&lt;P_wn&gt;(k, p.occupancy(), p.c) &amp; ~p.allPieces[Co_Black]); break;</span></span>
<span id="L528"><span class="lineNum">     528</span>              :          case P_bp:</span>
<span id="L529"><span class="lineNum">     529</span> <span class="tlaUNC">           0 :             Logging::LogIt(Logging::logInfo) &lt;&lt; ToString((BBTools::coverage&lt;P_wp&gt;(k, p.occupancy(), p.c) + BBTools::mask[k].push[p.c]) &amp;</span></span>
<span id="L530"><span class="lineNum">     530</span> <span class="tlaUNC">           0 :                                                          ~p.allPieces[Co_Black]);</span></span>
<span id="L531"><span class="lineNum">     531</span> <span class="tlaUNC">           0 :             break;</span></span>
<span id="L532"><span class="lineNum">     532</span> <span class="tlaUNC">           0 :          default: Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(emptyBitBoard);</span></span>
<span id="L533"><span class="lineNum">     533</span>              :       }</span>
<span id="L534"><span class="lineNum">     534</span> <span class="tlaUNC">           0 :       return true;</span></span>
<span id="L535"><span class="lineNum">     535</span>              :    }</span>
<span id="L536"><span class="lineNum">     536</span>              : </span>
<span id="L537"><span class="lineNum">     537</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-eval&quot;) {</span></span>
<span id="L538"><span class="lineNum">     538</span> <span class="tlaUNC tlaBgUNC">           0 :       EvalData data;</span></span>
<span id="L539"><span class="lineNum">     539</span> <span class="tlaUNC">           0 :       if (DynamicConfig::useNNUE) DynamicConfig::forceNNUE = true;</span></span>
<span id="L540"><span class="lineNum">     540</span> <span class="tlaUNC">           0 :       const ScoreType score = eval(p, data, ThreadPool::instance().main(), true, true);</span></span>
<span id="L541"><span class="lineNum">     541</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;eval &quot; &lt;&lt; score &lt;&lt; &quot; phase &quot; &lt;&lt; data.gp;</span></span>
<span id="L542"><span class="lineNum">     542</span>              :       return true;</span>
<span id="L543"><span class="lineNum">     543</span>              :    }</span>
<span id="L544"><span class="lineNum">     544</span>              : </span>
<span id="L545"><span class="lineNum">     545</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-evalHCE&quot;) {</span></span>
<span id="L546"><span class="lineNum">     546</span> <span class="tlaUNC tlaBgUNC">           0 :       EvalData data;</span></span>
<span id="L547"><span class="lineNum">     547</span> <span class="tlaUNC">           0 :       if (DynamicConfig::useNNUE) DynamicConfig::useNNUE = false;</span></span>
<span id="L548"><span class="lineNum">     548</span> <span class="tlaUNC">           0 :       const ScoreType score = eval(p, data, ThreadPool::instance().main(), true, true);</span></span>
<span id="L549"><span class="lineNum">     549</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;eval &quot; &lt;&lt; score &lt;&lt; &quot; phase &quot; &lt;&lt; data.gp;</span></span>
<span id="L550"><span class="lineNum">     550</span>              :       return true;</span>
<span id="L551"><span class="lineNum">     551</span>              :    }</span>
<span id="L552"><span class="lineNum">     552</span>              : </span>
<span id="L553"><span class="lineNum">     553</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-gen&quot;) {</span></span>
<span id="L554"><span class="lineNum">     554</span> <span class="tlaUNC tlaBgUNC">           0 :       MoveList moves;</span></span>
<span id="L555"><span class="lineNum">     555</span> <span class="tlaUNC">           0 :       MoveGen::generate&lt;MoveGen::GP_all&gt;(p, moves);</span></span>
<span id="L556"><span class="lineNum">     556</span> <span class="tlaUNC">           0 :       CMHPtrArray cmhPtr = {nullptr};</span></span>
<span id="L557"><span class="lineNum">     557</span> <span class="tlaUNC">           0 :       MoveSorter::scoreAndSort(ThreadPool::instance().main(), moves, p, 0.f, 0, cmhPtr);</span></span>
<span id="L558"><span class="lineNum">     558</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;nb moves : &quot; &lt;&lt; moves.size();</span></span>
<span id="L559"><span class="lineNum">     559</span> <span class="tlaUNC">           0 :       for (const auto &amp; it : moves) { Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(it, true); }</span></span>
<span id="L560"><span class="lineNum">     560</span>              :       return true;</span>
<span id="L561"><span class="lineNum">     561</span>              :    }</span>
<span id="L562"><span class="lineNum">     562</span>              : </span>
<span id="L563"><span class="lineNum">     563</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-testmove&quot;) {</span></span>
<span id="L564"><span class="lineNum">     564</span>              :       ///@todo</span>
<span id="L565"><span class="lineNum">     565</span>              :       constexpr Move m  = ToMove(8, 16, T_std);</span>
<span id="L566"><span class="lineNum">     566</span> <span class="tlaUNC tlaBgUNC">           0 :       Position p2 = p;</span></span>
<span id="L567"><span class="lineNum">     567</span>              : #if defined(WITH_NNUE) &amp;&amp; defined(DEBUG_NNUE_UPDATE)</span>
<span id="L568"><span class="lineNum">     568</span>              :       p2.associateEvaluator(evaluator);</span>
<span id="L569"><span class="lineNum">     569</span>              :       p2.resetNNUEEvaluator(p2.evaluator());</span>
<span id="L570"><span class="lineNum">     570</span>              : #endif</span>
<span id="L571"><span class="lineNum">     571</span> <span class="tlaUNC">           0 :       if (const MoveInfo moveInfo(p2, m); !applyMove(p2, moveInfo)) { </span></span>
<span id="L572"><span class="lineNum">     572</span> <span class="tlaUNC">           0 :          Logging::LogIt(Logging::logError) &lt;&lt; &quot;Cannot apply this move&quot;;</span></span>
<span id="L573"><span class="lineNum">     573</span>              :       }</span>
<span id="L574"><span class="lineNum">     574</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; ToString(p2);</span></span>
<span id="L575"><span class="lineNum">     575</span>              :       return true;</span>
<span id="L576"><span class="lineNum">     576</span> <span class="tlaUNC">           0 :    }</span></span>
<span id="L577"><span class="lineNum">     577</span>              : </span>
<span id="L578"><span class="lineNum">     578</span> <span class="tlaGNC tlaBgGNC">           3 :    if (firstArg == &quot;-perft&quot;) {</span></span>
<span id="L579"><span class="lineNum">     579</span>              :       DepthType d = 5;</span>
<span id="L580"><span class="lineNum">     580</span> <span class="tlaGNC">           2 :       if (argc &gt; 3) d = clampIntU&lt;DepthType&gt;(atoi(args[3]));</span></span>
<span id="L581"><span class="lineNum">     581</span> <span class="tlaGNC">           1 :       PerftAccumulator acc;</span></span>
<span id="L582"><span class="lineNum">     582</span> <span class="tlaGNC">           1 :       auto start = Clock::now();</span></span>
<span id="L583"><span class="lineNum">     583</span> <span class="tlaGNC">           1 :       perft(p, d, acc);</span></span>
<span id="L584"><span class="lineNum">     584</span>              :       auto elapsed = getTimeDiff(start);</span>
<span id="L585"><span class="lineNum">     585</span> <span class="tlaGNC">           1 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Perft done in &quot; &lt;&lt; elapsed &lt;&lt; &quot;ms&quot;;</span></span>
<span id="L586"><span class="lineNum">     586</span> <span class="tlaGNC">           1 :       acc.Display();</span></span>
<span id="L587"><span class="lineNum">     587</span> <span class="tlaGNC">           2 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Speed &quot; &lt;&lt; static_cast&lt;int&gt;(acc.validNodes / elapsed) &lt;&lt; &quot;KNPS&quot;;</span></span>
<span id="L588"><span class="lineNum">     588</span>              :       return true;</span>
<span id="L589"><span class="lineNum">     589</span>              :    }</span>
<span id="L590"><span class="lineNum">     590</span>              : </span>
<span id="L591"><span class="lineNum">     591</span> <span class="tlaGNC">           2 :    if (firstArg == &quot;-analyze&quot;) {</span></span>
<span id="L592"><span class="lineNum">     592</span>              :       DepthType depth = 15;</span>
<span id="L593"><span class="lineNum">     593</span> <span class="tlaGNC">           4 :       if (argc &gt; 3) depth = clampIntU&lt;DepthType&gt;(atoi(args[3]));</span></span>
<span id="L594"><span class="lineNum">     594</span> <span class="tlaGNC">           2 :       auto start = Clock::now();</span></span>
<span id="L595"><span class="lineNum">     595</span> <span class="tlaGNC">           2 :       analyze(p, depth);</span></span>
<span id="L596"><span class="lineNum">     596</span>              :       auto elapsed = getTimeDiff(start);</span>
<span id="L597"><span class="lineNum">     597</span> <span class="tlaGNC">           2 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Analysis done in &quot; &lt;&lt; elapsed &lt;&lt; &quot;ms&quot;;</span></span>
<span id="L598"><span class="lineNum">     598</span>              :       return true;</span>
<span id="L599"><span class="lineNum">     599</span>              :    }</span>
<span id="L600"><span class="lineNum">     600</span>              : </span>
<span id="L601"><span class="lineNum">     601</span> <span class="tlaUNC tlaBgUNC">           0 :    if (firstArg == &quot;-mateFinder&quot;) {</span></span>
<span id="L602"><span class="lineNum">     602</span> <span class="tlaUNC">           0 :       DynamicConfig::mateFinder = true;</span></span>
<span id="L603"><span class="lineNum">     603</span>              :       DepthType depth = 10;</span>
<span id="L604"><span class="lineNum">     604</span> <span class="tlaUNC">           0 :       if (argc &gt; 3) depth = clampIntU&lt;DepthType&gt;(atoi(args[3]));</span></span>
<span id="L605"><span class="lineNum">     605</span> <span class="tlaUNC">           0 :       auto start = Clock::now();</span></span>
<span id="L606"><span class="lineNum">     606</span> <span class="tlaUNC">           0 :       analyze(p, depth);</span></span>
<span id="L607"><span class="lineNum">     607</span>              :       auto elapsed = getTimeDiff(start);</span>
<span id="L608"><span class="lineNum">     608</span> <span class="tlaUNC">           0 :       Logging::LogIt(Logging::logInfo) &lt;&lt; &quot;Analysis done in &quot; &lt;&lt; elapsed &lt;&lt; &quot;ms&quot;;</span></span>
<span id="L609"><span class="lineNum">     609</span>              :       return true;</span>
<span id="L610"><span class="lineNum">     610</span>              :    }</span>
<span id="L611"><span class="lineNum">     611</span>              : </span>
<span id="L612"><span class="lineNum">     612</span> <span class="tlaUNC">           0 :    Logging::LogIt(Logging::logError) &lt;&lt; &quot;unknown command line : &quot; &lt;&lt; firstArg;</span></span>
<span id="L613"><span class="lineNum">     613</span> <span class="tlaUNC">           0 :    return false;</span></span>
<span id="L614"><span class="lineNum">     614</span> <span class="tlaGNC tlaBgGNC">           3 : }</span></span>
        </pre>
              </td>
            </tr>
          </table>
          <br>

          <table width="100%" border=0 cellspacing=0 cellpadding=0>
            <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
            <tr><td class="versionInfo">Generated by: <a href="https://github.com//linux-test-project/lcov" target="_parent">LCOV version 2.0-1</a></td></tr>
          </table>
          <br>

</body>
</html>
